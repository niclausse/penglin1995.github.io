---
title: Go语言函数回调及闭包
date: 2019-12-26 11:12:42
tags: Go
categories: go
---

## 一、高阶函数

当函数具备以下两种特性的时候，就可以称之为高阶函数：

* 函数可以作为另一个函数的参数(典型用法是回调函数)
* 函数可以返回另一个函数，即让另一个函数作为这个函数的返回值(典型用法是闭包)

一般来说，附带的还具备一个特性：函数可以作为一个值赋值给变量。

## 二、回调函数

Go语言中，允许使用函数作为另一个函数的参数。

## 三、闭包

Go 语⾔言⽀支持匿匿名函数，可作为闭包。匿匿名函数是⼀一个"内联"语句句或表达式。匿匿名函数的优越性在于可以直接使⽤用函数内的变量量，不不必申明。

`闭包是将函数内部与外部链接起来的桥梁`

闭包最大的用处有两个：

* 可以读取函数内部的变量
* 变量的值始终保存在内存中

以下实例例中，创建了了函数 getSequence() ，返回另外⼀一个函数。该函数的⽬目的是在闭包中递增 i变量，代码如下：

```json
package closure

func getSequence() func() int {
	i := 0
	return func() int {
		i++
		return i
	}
}
```



调用代码如下：

```json
package closure

import (
	"fmt"
	"testing"
)

func TestClosure(t *testing.T) {
	f1 := getSequence()
	// 调用f1函数，i变量自增1并返回
	fmt.Println(f1()) // 1
	fmt.Println(f1()) // 2
	fmt.Println(f1()) // 3

	f2 := getSequence()
	fmt.Println(f2()) // 1
	fmt.Println(f2()) // 2
	fmt.Println(f2()) // 3
}
```



### 注意：

* 由于闭包会使得函数中的变量量都被保存在内存中，内存消耗很⼤大，所以不不能滥⽤用闭包，否则会造

  成⽹网⻚页的性能问题，在IE中可能导致内存泄露露。**解决⽅方法是，在退出函数之前，将不使⽤用的局部变**

  **量全部删除**。

* 闭包会在⽗父函数外部，改变⽗父函数内部变量量的值。所以，如果你把⽗父函数当作对象（object）使

  ⽤用，把闭包当作它的公⽤用⽅方法（Public Method），把内部变量量当作它的私有属性（private

  value），这时⼀一定要⼩小⼼心，不不要随便便改变⽗父函数内部变量量的值。